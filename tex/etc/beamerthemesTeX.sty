% Beamer sTeX slide theme;
% Copyright (c) 20 Michael Kohlhase <michael.kohlhase@fau.de>.
\ProvidesPackage{beamerthemesTeX}
\typeout{Beamer sTeX theme}
\RequirePackage{xspace}
\RequirePackage{xcolor}
\RequirePackage{stex}
\RequirePackage{amsthm}
\RequirePackage{thmtools}

% General appearance  of theorems, like "ams style", but without the block env. 
\setbeamertemplate{theorem begin}
{%
  \inserttheoremheadfont
  \inserttheoremname
  \inserttheoremnumber
  \ifx \inserttheoremaddition \empty \else\ (\inserttheoremaddition)\fi
  \inserttheorempunctuation\xspace
  \inserttheorembodyfont
}
\setbeamertemplate{theorem end}{}

\ExplSyntaxOn
\declaretheorem[parent=section]{theorem}
\stexpatchassertion[theorem]
{\ifx\sassertiontitle\@empty\begin{theorem}\else\exp_args:Nno\use:nn{\begin{theorem}[}\sassertiontitle]\fi}
{\end{theorem}}    

\declaretheorem[sibling=theorem]{observation}
\stexpatchassertion[observation]
{\ifx\sassertiontitle\@empty\begin{observation}\else\exp_args:Nno\use:nn{\begin{observation}[}\sassertiontitle]\fi}
{\end{observation}}

\declaretheorem[sibling=theorem]{corollary}
\stexpatchassertion[corollary]
{\ifx\sassertiontitle\@empty\begin{corollary}\else\exp_args:Nno\use:nn{\begin{corollary}[}\sassertiontitle]\fi}
{\end{corollary}}

\declaretheorem[sibling=theorem]{lemma}
\stexpatchassertion[lemma]
{\ifx\sassertiontitle\@empty\begin{lemma}\else\exp_args:Nno\use:nn{\begin{lemma}[}\sassertiontitle]\fi}
{\end{lemma}}
  
\declaretheorem[sibling=theorem]{axiom}
\stexpatchassertion[axiom]
{\ifx\sassertiontitle\@empty\begin{axiom}\else\exp_args:Nno\use:nn{\begin{axiom}[}\sassertiontitle]\fi}
{\end{axiom}}

\declaretheorem[sibling=theorem,style=remark]{remark}
\stexpatchassertion[remark]
{\ifx\sassertiontitle\@empty\begin{remark}\else\exp_args:Nno\use:nn{\begin{remark}[}\sassertiontitle]\fi}
{\end{remark}}
\stexpatchparagraph[remark]
{\ifx\sparagraphtitle\@empty\begin{remark}\else\exp_args:Nno\use:nn{\begin{remark}[}\sparagraphtitle]\fi}
{\end{remark}}

\declaretheorem[sibling=theorem,style=definition]{example}
\stexpatchexample
{\ifx\sexampletitle\@empty\begin{example}\else\exp_args:Nno\use:nn{\begin{example}[}\sexampletitle]\fi}
{\end{example}}

\declaretheorem[sibling=theorem,style=definition]{definition}
\stexpatchdefinition
{\ifx\sdefinitiontitle\@empty\begin{definition}\else\exp_args:Nno\use:nn{\begin{definition}[}\sdefinitiontitle]\fi}
    {\end{definition}}
\ExplSyntaxOff

% THEME
\mode
<presentation>

\sffamily

\ifcsname slidelogo\endcsname\else
  \newsavebox\slidelogo
  \sbox\slidelogo{\sTeX}
\fi

%% Logo images
\pgfdeclareimage[height=2ex]{instlogo}{sTeX-logo}
\pgfdeclareimage[height=2ex]{cclogo}{stex-cc_somerights}

%% A simple frame title with a long rule under it. 
\setbeamertemplate{frametitle}{%
    \usebeamerfont{frametitle}\insertframetitle\strut%
    \vskip-.1\baselineskip%
    \leaders\vrule width \paperwidth\vskip0.4pt%
    \vskip0pt%
    \nointerlineskip
}

%% A Footer line with a Institution and CC logos
\setbeamertemplate{footline}[text line]{%
  \usebeamercolor[fg]{titlelike}
  \usebox\slidelogo\hspace*{1cm}\insertshortauthor: \insertshorttitle\hfill{}%
  \insertframenumber\hfill\insertshortdate\hspace*{1cm}\pgfuseimage{cclogo}%
  }

%% Turn off the navigation symbols
\setbeamertemplate{navigation symbols}{}

%% Inner theme
\useinnertheme{default}
%\setbeamertemplate{enumerate item}{(\alph{enumi})}
%\setbeamertemplate{enumerate subitem}{(\roman{enumii})}

\mode
<all>

%% Redefine various margin sizes 
\setbeamersize{text margin left=3mm}
\setbeamersize{text margin right=3mm}
\setbeamersize{description width=0.57cm}
\setlength\leftmargini{1em}
\setlength\leftmarginii{1em}
\setlength\leftmarginiii{1em}
\providecommand{\vstretch}[1]{\vspace*{\stretch{#1}}}

%% set the colors for sTeX content highlighting

\def\compemph#1{\ifcsname textcolor\endcsname\textcolor{SteelBlue}{#1}\else#1\fi}
\def\symrefemph#1{\ifcsname textcolor\endcsname\textcolor{SteelBlue}{#1}\else#1\fi}
\def\defemph#1{\ifcsname textcolor\endcsname\textcolor{magenta}{#1}\else\textbf{#1}\fi}
\def\varemph#1{\ifcsname textcolor\endcsname\textcolor{gray}{#1}\else#1\fi}
\def\titleemph#1{\ifcsname textcolor\endcsname\textcolor{blue}{#1}\else\textbf{#1}\fi}

%% set PDF tooltips
\RequirePackage{pdfcomment}
\protected\def\compemph@uri#1#2{%
  \pdftooltip{%
    \srefsymuri{#2}{\compemph{#1}}%
  }{%
    URI:~\detokenize{#2}%
  }%
}
\protected\def\symrefemph@uri#1#2{%
  \pdftooltip{%
    \srefsymuri{#2}{\symrefemph{#1}}%
  }{%
    URI:~\detokenize{#2}%
  }%
}
\protected\def\defemph@uri#1#2{%
  \pdftooltip{%
    \defemph{#1}%
  }{%
    URI:~\detokenize{#2}%
  }%
}
\protected\def\varemph@uri#1#2{%
  \pdftooltip{%
    \varemph{#1}%
  }{%
    Variable~\detokenize{#2}%
  }%
}
