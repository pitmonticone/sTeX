%%
%% This is file `mikoslides.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% mikoslides.dtx  (with options: `package')
%% 
\ProvidesExplPackage{mikoslides}{2020/12/06}{1.3}{MiKo slides Package}
\RequirePackage{l3keys2e,expl-keystr-compat}

\keys_define:nn{mikoslides / pkg}{
  topsect         .str_set_x:N  = \c__mikoslides_topsect_str,
  defaulttopsect  .str_set_x:N  = \c__mikoslides_defaulttopsec_str,
  notes           .bool_set:N   = \c__mikoslides_notes_bool ,
  slides          .code:n       = { \bool_set_false:N \c__mikoslides_notes_bool },
  sectocframes    .bool_set:N   = \c__mikoslides_sectocframes_bool ,
  frameimages     .bool_set:N   = \c__mikoslides_frameimages_bool ,
  fiboxed         .bool_set:N   = \c__mikoslides_fiboxed_bool ,
  noproblems      .bool_set:N   = \c__mikoslides_noproblems_bool,
  unknown .code:n      = {
    \PassOptionsToClass{\CurrentOption}{stex}
    \PassOptionsToClass{\CurrentOption}{tikzinput}
  }
}
\ProcessKeysOptions{ mikosllides / pkg }

\str_if_empty:NTF \c__mikoslides_topsect_str {
  \str_set_eq:NN \__mikoslidestopsect \c__mikoslides_defaulttopsec_str
}{
  \str_set_eq:NN \__mikoslidestopsect \c__mikoslides_topsect_str
}
\RequirePackage{stex-compatibility}
\RequirePackage{stex-tikzinput}
\bool_if:NT \c__mikoslides_notes_bool {
  \RequirePackage{a4wide}
  \RequirePackage{marginnote}
  \PassOptionsToPackage{dvipsnames,svgnames}{xcolor}
  \RequirePackage{mdframed}
  \RequirePackage[noxcolor,noamsthm]{beamerarticle}
  \RequirePackage[bookmarks,bookmarksopen,bookmarksnumbered,breaklinks,hidelinks]{hyperref}
}
\RequirePackage{etoolbox}
\RequirePackage{amssymb}
\RequirePackage{amsmath}
\RequirePackage{comment}
\RequirePackage{textcomp}
\RequirePackage{url}
\RequirePackage{graphicx}
\RequirePackage{pgf}
\bool_if:NT \c__mikoslides_notes_bool {
  \renewcommand\usetheme[2][]{\usepackage[#1]{beamernotestheme#2}}
}
\newcounter{slide}
\newlength{\slidewidth}\setlength{\slidewidth}{13.5cm}
\newlength{\slideheight}\setlength{\slideheight}{9cm}
\ifmks@sty@notes%
  \renewenvironment{note}{\ignorespaces}{}%
\else%
  \excludecomment{note}%
\fi%
\ifmks@sty@notes
  \newlength{\slideframewidth}
  \setlength{\slideframewidth}{1.5pt}
  \addmetakey{frame}{label}
  \addmetakey[yes]{frame}{allowframebreaks}
  \addmetakey{frame}{allowdisplaybreaks}
  \addmetakey[yes]{frame}{fragile}
  \addmetakey[yes]{frame}{shrink}
  \addmetakey[yes]{frame}{squeeze}
  \addmetakey[yes]{frame}{t}
  \renewenvironment{frame}[1][]{%
    \metasetkeys{frame}{#1}%
    \sffamily%
    \stepcounter{slide}%
    \def\@currentlabel{\theslide}%
    \ifx\frame@label\@empty\else\label{\frame@label}\fi%
    \def\itemize@level{outer}%
    \def\itemize@outer{outer}%
    \def\itemize@inner{inner}%
    \renewcommand\newpage{\addtocounter{framenumber}{1}}%
    \renewcommand\metakeys@show@keys[2]{\marginnote{{\scriptsize ##2}}}%
    \renewenvironment{itemize}{%
      \ifx\itemize@level\itemize@outer%
        \def\itemize@label{$\rhd$}%
      \fi%
      \ifx\itemize@level\itemize@inner%
        \def\itemize@label{$\scriptstyle\rhd$}%
      \fi%
      \begin{list}%
      {\itemize@label}%
      {\setlength{\labelsep}{.3em}%
       \setlength{\labelwidth}{.5em}%
       \setlength{\leftmargin}{1.5em}%
      }%
      \edef\itemize@level{\itemize@inner}%
    }{%
      \end{list}%
    }%
    \begin{mdframed}[linewidth=\slideframewidth,skipabove=1ex,skipbelow=1ex,userdefinedwidth=\slidewidth,align=center]\sf%
  }{%
    \medskip\miko@slidelabel\end{mdframed}%
  }%
  \renewcommand{\frametitle}[1]{{\Large\bf\sf\color{blue}{#1}}\medskip}%
\fi %ifmks@sty@notes
\ifmks@sty@notes\newcommand\pause{}\fi
\ifmks@sty@notes\newenvironment{nomtext}[1][]{\begin{omtext}[#1]}{\end{omtext}}%
\else\excludecomment{nomtext}\fi%
\ifmks@sty@notes\newenvironment{nomgroup}[2][]{\begin{omgroup}[#1]{#2}}{\end{omgroup}}%
\else\excludecomment{nomgroup}\fi%
\ifmks@sty@notes\newenvironment{ndefinition}[1][]{\begin{definition}[#1]}{\end{definition}}%
\else\excludecomment{ndefinition}\fi%
\ifmks@sty@notes\newenvironment{nassertion}[1][]{\begin{assertion}[#1]}{\end{assertion}}%
\else\excludecomment{nassertion}\fi%
\ifmks@sty@notes\newenvironment{nsproof}[2][]{\begin{sproof}[#1]{#2}}{\end{sproof}}%
\else\excludecomment{nsproof}\fi%
\ifmks@sty@notes\newenvironment{nexample}[1][]{\begin{example}[#1]}{\end{example}}%
\else\excludecomment{nexample}\fi%
\def\inputref@preskip{\smallskip}
\def\inputref@postskip{\medskip}
\let\orig@inputref\inputref
\def\inputref{\@ifstar\ninputref\orig@inputref}
\newcommand\ninputref[2][]{\ifmks@sty@notes\orig@inputref[#1]{#2}\fi}
\newlength{\slidelogoheight}
\ifmks@sty@notes%
  \setlength{\slidelogoheight}{.4cm}%
\else%
  \setlength{\slidelogoheight}{1cm}%
\fi%
\newsavebox{\slidelogo}%
\sbox{\slidelogo}{\sTeX}%
\newrobustcmd{\setslidelogo}[1]{%
  \sbox{\slidelogo}{\includegraphics[height=\slidelogoheight]{#1}}%
}%
\def\source{Michael Kohlhase}% customize locally
\newrobustcmd{\setsource}[1]{\def\source{#1}}%
\def\copyrightnotice{\footnotesize\copyright:\hspace{.3ex}{\source}}%
\newsavebox{\cclogo}%
\sbox{\cclogo}{\includegraphics[height=\slidelogoheight]{cc_somerights}}%
\newif\ifcchref\cchreffalse%
\AtBeginDocument{%
  \@ifpackageloaded{hyperref}{\cchreftrue}{\cchreffalse}
}%
\def\licensing{%
  \ifcchref%
    \href{http://creativecommons.org/licenses/by-sa/2.5/}{\usebox{\cclogo}}%
  \else%
    {\usebox{\cclogo}}%
  \fi%
}%
\newrobustcmd{\setlicensing}[2][]{%
  \def\@url{#1}%
  \sbox{\cclogo}{\includegraphics[height=\slidelogoheight]{#2}}%
  \ifx\@url\@empty%
    \def\licensing{{\usebox{\cclogo}}}%
  \else%
    \def\licensing{%
      \ifcchref%
      \href{#1}{\usebox{\cclogo}}%
      \else%
      {\usebox{\cclogo}}%
      \fi%
    }%
  \fi%
}%
\newrobustcmd\miko@slidelabel{%
  \vbox to \slidelogoheight{%
    \vss\hbox to \slidewidth%
    {\licensing\hfill\copyrightnotice\hfill\arabic{slide}\hfill\usebox{\slidelogo}}%
  }%
}%
\def\Gin@mhrepos{}
\define@key{Gin}{mhrepos}{\def\Gin@mhrepos{#1}}
\define@key{Gin}{label}{\def\@currentlabel{\arabic{slide}}\label{#1}}
\newrobustcmd\frameimage[2][]{%
  \stepcounter{slide}%
  \ifmks@sty@frameimages%
    \def\Gin@ewidth{}\setkeys{Gin}{#1}%
    \ifmks@sty@notes\else\vfill\fi%
    \begin{center}
      \ifmks@sty@fiboxed%
      \fbox{\ifx\Gin@ewidth\@empty%
        \ifx\Gin@mhrepos\@empty\mhgraphics[width=\slidewidth,#1]{#2}%
        \else\mhgraphics[width=\slidewidth,#1,mhrepos=\Gin@mhrepos]{#2}\fi%
        \else% Gin@ewidth empty
        \ifx\Gin@mhrepos\@empty\mhgraphics[#1]{#2}%
        \else\mhgraphics[#1,mhrepos=\Gin@mhrepos]{#2}\fi%
        \fi}% Gin@ewidth empty
      \else% ifmks@sty@fiboxed
      \ifx\Gin@ewidth\@empty%
      \ifx\Gin@mhrepos\@empty\mhgraphics[width=\slidewidth,#1]{#2}%
      \else\mhgraphics[width=\slidewidth,#1,mhrepos=\Gin@mhrepos]{#2}\fi%
      \ifx\Gin@mhrepos\@empty\else\mhgraphics[#1]{#2}%
      \else\mhgraphics[#1,mhrepos=\Gin@mhrepos]{#2}\fi%
      \fi% Gin@ewidth empty
      \fi% ifmks@sty@fiboxed
     \end{center}
    \par\strut\hfill{\footnotesize Slide \arabic{slide}}%
    \ifmks@sty@notes\else\vfill\fi%
  \fi} % ifmks@sty@frameimages
\sffamily
\AtBeginDocument{%
\definecolor{green}{rgb}{0,.5,0}%
\definecolor{purple}{cmyk}{.3,1,0,.17}%
}%
\def\defemph#1{{\textcolor{magenta}{#1}}}
\def\symrefemph#1{{\textcolor{cyan}{#1}}}
\def\compemph#1{{\textcolor{blue}{#1}}}
\def\titleemph#1{{\textcolor{blue}{#1}}}
\def\__mikoslideslec#1{(\textcolor{green}{#1})}
\pgfdeclareimage[width=.8em]{miko@small@dbend}{dangerous-bend}
\def\smalltextwarning{%
  \pgfuseimage{miko@small@dbend}%
  \xspace%
}%
\pgfdeclareimage[width=1.2em]{miko@dbend}{dangerous-bend}
\newrobustcmd\textwarning{%
  \raisebox{-.05cm}{\pgfuseimage{miko@dbend}}%
  \xspace%
}%
\pgfdeclareimage[width=2.5em]{miko@big@dbend}{dangerous-bend}%
\newrobustcmd\bigtextwarning{%
  \raisebox{-.05cm}{\pgfuseimage{miko@big@dbend}}%
  \xspace%
}%
\newrobustcmd\putgraphicsat[3]{%
  \begin{picture}(0,0)\put(#1){\includegraphics[#2]{#3}}\end{picture}%
}%
\newrobustcmd\putat[2]{%
  \begin{picture}(0,0)\put(#1){#2}\end{picture}%
}%
\ifmks@sty@sectocframes%
\ifdefstring\__mikoslidestopsect{part}{%
  \newcounter{chapter}\counterwithin*{section}{chapter}}
{\ifdefstring\__mikoslidestopsect{chapter}{\newcounter{chapter}\counterwithin*{section}{chapter}}{}}
\fi% ifsectocframes
\section@level=2
\def\part@prefix{}
\ifdefstring{\__mikoslidestopsect}{part}
{\section@level=0%
  \def\thesection{\arabic{chapter}.\arabic{section}}%
  \def\part@prefix{\arabic{chapter}.}}{}
\ifdefstring{\__mikoslidestopsect}{chapter}
{\section@level=1%
  \def\thesection{\arabic{chapter}.\arabic{section}}%
  \def\part@prefix{\arabic{chapter}.}}{}
\ifmks@sty@notes\else% only in slides
\renewenvironment{omgroup}[2][]{%
  \metasetkeys{omgroup}{#1}%
  \advance\section@level by 1%
  \advance\omgroup@level by 1%
  \ifmks@sty@sectocframes%
  \stepcounter{slide}
  \begin{frame}[noframenumbering]%
  \vfill\Large\centering%
  \red{%
    \ifcase\section@level\or
    \stepcounter{part}
    \def\__mikoslideslabel{\omdoc@part@kw~\Roman{part}}
    \def\currentsectionlevel{\omdoc@part@kw}
    \or%
    \stepcounter{chapter}
    \def\__mikoslideslabel{\omdoc@chapter@kw~\arabic{chapter}}
    \def\currentsectionlevel{\omdoc@chapter@kw}
    \or
    \stepcounter{section}
    \def\__mikoslideslabel{\part@prefix\arabic{section}}
    \def\currentsectionlevel{\omdoc@section@kw}
    \or
    \stepcounter{subsection}
    \def\__mikoslideslabel{\part@prefix\arabic{section}.\arabic{subsection}}
    \def\currentsectionlevel{\omdoc@subsection@kw}
    \or
    \stepcounter{subsubsection}
    \def\__mikoslideslabel{\part@prefix\arabic{section}.\arabic{subsection}.\arabic{subsubsection}}
    \def\currentsectionlevel{\omdoc@subsubsection@kw}
    \or
    \stepcounter{mparagraph}
    \def\__mikoslideslabel{\part@prefix\arabic{section}.\arabic{msubsection}.\arabic{subsubsection}.\arabic{mparagraph}}
    \def\currentsectionlevel{\omdoc@paragraph@kw}
    \fi% end ifcase
    \__mikoslideslabel\sref@label@id\__mikoslideslabel
    \quad #2%
  }%
  \vfill%
  \end{frame}%
  \fi %ifmks@sty@sectocframes
  \csname stex_ref_new_doc_target:n\endcsname\omgroup@id%
}
{\advance\section@level by -1}%
\fi% ifmks@sty@notes
\def\inserttheorembodyfont{\normalfont}
\ifmks@sty@notes\else% only in slides
\defbeamertemplate{theorem begin}{miko}
{\inserttheoremheadfont\inserttheoremname\inserttheoremnumber
  \ifx\inserttheoremaddition\@empty\else\ (\inserttheoremaddition)\fi%
  \inserttheorempunctuation\inserttheorembodyfont\xspace}
\defbeamertemplate{theorem end}{miko}{}
\setbeamertemplate{theorems}[miko]
\expandafter\def\csname Parent2\endcsname{}
\fi% ifmks@sty@notes
\ifmks@sty@notes%
  \renewenvironment{columns}[1][]{%
    \par\noindent%
    \begin{minipage}%
    \slidewidth\centering\leavevmode%
  }{%
    \end{minipage}\par\noindent%
  }%
  \newsavebox\columnbox%
  \renewenvironment<>{column}[2][]{%
    \begin{lrbox}{\columnbox}\begin{minipage}{#2}%
  }{%
    \end{minipage}\end{lrbox}\usebox\columnbox%
  }%
\fi% ifmks@sty@notes
\ifmks@sty@noproblems%
  \newenvironment{problems}{}{}%
\else%
  \excludecomment{problems}%
\fi%
\gdef\printexcursions{}
\newcommand\excursionref[2]{% label, text
\ifnotes\begin{omtext}[title=Excursion]#2 \sref[fallback=the appendix]{#1}.\end{omtext}\fi}
\newcommand\activate@excursion[2][]{\gappto\printexcursions{\inputref[#1]{#2}}}
\newcommand\excursion[4][]{% repos, label, path, text
  \ifnotes\activate@excursion[#1]{#3}\excursionref{#2}{#4}\fi}%
\srefaddidkey{excursiongroup}%
\addmetakey{excursiongroup}{intro}%
\addmetakey{excursiongroup}{mhrepos}%
\newcommand\excursiongroup[1][]{\metasetkeys{excursiongroup}{#1}%
  \ifdefempty\printexcursions{}% only if there are excursions
  {\begin{omgroup}[#1]{Excursions}%
      \ifdefempty\excursiongroup@intro{}{\inputref[\excursiongroup@mhrepos]{\excursiongroup@intro}}%
      \printexcursions%
    \end{omgroup}}}
\endinput
%%
%% End of file `mikoslides.sty'.
