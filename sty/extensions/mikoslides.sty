%%
%% This is file `mikoslides.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% mikoslides.dtx  (with options: `package')
%% 
\ProvidesExplPackage{mikoslides}{2020/12/06}{1.3}{MiKo slides Package}
\RequirePackage{l3keys2e,expl-keystr-compat}

\keys_define:nn{mikoslides / pkg}{
  topsect         .str_set_x:N  = \c__mikoslides_topsect_str,
  defaulttopsect  .str_set_x:N  = \c__mikoslides_defaulttopsec_str,
  notes           .bool_set:N   = \c__mikoslides_notes_bool ,
  slides          .code:n       = { \bool_set_false:N \c__mikoslides_notes_bool },
  sectocframes    .bool_set:N   = \c__mikoslides_sectocframes_bool ,
  frameimages     .bool_set:N   = \c__mikoslides_frameimages_bool ,
  fiboxed         .bool_set:N   = \c__mikoslides_fiboxed_bool ,
  noproblems      .bool_set:N   = \c__mikoslides_noproblems_bool,
  unknown         .code:n       = {
    \PassOptionsToClass{\CurrentOption}{stex}
    \PassOptionsToClass{\CurrentOption}{tikzinput}
  }
}
\ProcessKeysOptions{ mikoslides / pkg }
\newif\ifnotes
\bool_if:NTF \c__mikoslides_notes_bool {
  \notestrue
}{
  \notesfalse
}

\str_if_empty:NTF \c__mikoslides_topsect_str {
  \str_set_eq:NN \__mikoslidestopsect \c__mikoslides_defaulttopsec_str
}{
  \str_set_eq:NN \__mikoslidestopsect \c__mikoslides_topsect_str
}
\RequirePackage{stex-compatibility}
\RequirePackage{stex-tikzinput}
\bool_if:NT \c__mikoslides_notes_bool {
  \RequirePackage{a4wide}
  \RequirePackage{marginnote}
  \PassOptionsToPackage{dvipsnames,svgnames}{xcolor}
  \RequirePackage{mdframed}
  \RequirePackage[noxcolor,noamsthm]{beamerarticle}
  \RequirePackage[bookmarks,bookmarksopen,bookmarksnumbered,breaklinks,hidelinks]{hyperref}
}
\RequirePackage{etoolbox}
\RequirePackage{amssymb}
\RequirePackage{amsmath}
\RequirePackage{comment}
\RequirePackage{textcomp}
\RequirePackage{url}
\RequirePackage{graphicx}
\RequirePackage{pgf}
\bool_if:NT \c__mikoslides_notes_bool {
  \renewcommand\usetheme[2][]{\usepackage[#1]{beamernotestheme#2}}
}
\newcounter{slide}
\newlength{\slidewidth}\setlength{\slidewidth}{13.5cm}
\newlength{\slideheight}\setlength{\slideheight}{9cm}
\bool_if:NTF \c__mikoslides_notes_bool {
  \renewenvironment{note}{\ignorespaces}{}
}{
  \excludecomment{note}
}
\bool_if:NT \c__mikoslides_notes_bool {
  \newlength{\slideframewidth}
  \setlength{\slideframewidth}{1.5pt}
  \cs_new_protected:Nn \__mikoslides_do_yes_param:Nn {
    \exp_args:Nx \str_if_eq:nnTF { \str_uppercase:n{ #2 } }{ yes }{
      \bool_set_true:N #1
    }{
      \bool_set_false:N #1
    }
  }
  \keys_define:nn{mikoslides / frame}{
    label               .str_set_x:N  = \l__mikoslides_frame_label_str,
    allowframebreaks    .code:n       = {
      \__mikoslides_do_yes_param:Nn \l__mikoslides_frame_allowframebreaks_bool { #1 }
    },
    allowdisplaybreaks  .code:n       = {
      \__mikoslides_do_yes_param:Nn \l__mikoslides_frame_allowdisplaybreaks_bool { #1 }
    },
    fragile             .code:n       = {
      \__mikoslides_do_yes_param:Nn \l__mikoslides_frame_fragile_bool { #1 }
    },
    shrink              .code:n       = {
      \__mikoslides_do_yes_param:Nn \l__mikoslides_frame_shrink_bool { #1 }
    },
    squeeze             .code:n       = {
      \__mikoslides_do_yes_param:Nn \l__mikoslides_frame_squeeze_bool { #1 }
    },
    t                   .code:n       = {
      \__mikoslides_do_yes_param:Nn \l__mikoslides_frame_t_bool { #1 }
    },
  }
  \cs_new_protected:Nn \__mikoslides_frame_args:n {
    \str_clear:N \l__mikoslides_frame_label_str
    \bool_set_true:N \l__mikoslides_frame_allowframebreaks_bool
    \bool_set_true:N \l__mikoslides_frame_allowdisplaybreaks_bool
    \bool_set_true:N \l__mikoslides_frame_fragile_bool
    \bool_set_true:N \l__mikoslides_frame_shrink_bool
    \bool_set_true:N \l__mikoslides_frame_squeeze_bool
    \bool_set_true:N \l__mikoslides_frame_t_bool
    \keys_set:nn { mikoslides / frame }{ #1 }
  }
  \renewenvironment{frame}[1][]{
    \__mikoslides_frame_args:n{#1}
    \sffamily
    \stepcounter{slide}
    \def\@currentlabel{\theslide}
    \str_if_empty:NF \l__mikoslides_frame_label_str {
      \label{\l__mikoslides_frame_label_str}
    }
    \def\itemize@level{outer}
    \def\itemize@outer{outer}
    \def\itemize@inner{inner}
    \renewcommand\newpage{\addtocounter{framenumber}{1}}
    \newcommand\metakeys@show@keys[2]{\marginnote{{\scriptsize ##2}}}
    \renewenvironment{itemize}{
      \ifx\itemize@level\itemize@outer
        \def\itemize@label{$\rhd$}
      \fi
      \ifx\itemize@level\itemize@inner
        \def\itemize@label{$\scriptstyle\rhd$}
      \fi
      \begin{list}
      {\itemize@label}
      {\setlength{\labelsep}{.3em}
       \setlength{\labelwidth}{.5em}
       \setlength{\leftmargin}{1.5em}
      }
      \edef\itemize@level{\itemize@inner}
    }{
      \end{list}
    }
    \begin{mdframed}[linewidth=\slideframewidth,skipabove=1ex,skipbelow=1ex,userdefinedwidth=\slidewidth,align=center]\sf
  }{
    \medskip\miko@slidelabel\end{mdframed}
  }
  \renewcommand{\frametitle}[1]{{\Large\bf\sf\color{blue}{#1}}\medskip}
}
\bool_if:NT \c__mikoslides_notes_bool {
  \newcommand\pause{}
}
\bool_if:NTF \c__mikoslides_notes_bool {
  \newenvironment{nomtext}[1][]{\begin{omtext}[#1]}{\end{omtext}}
}{
  \excludecomment{nomtext}
}
\bool_if:NTF \c__mikoslides_notes_bool {
  \newenvironment{nomgroup}[2][]{\begin{omgroup}[#1]{#2}}{\end{omgroup}}
}{
  \excludecomment{nomgroup}
}
\bool_if:NTF \c__mikoslides_notes_bool {
  \newenvironment{ndefinition}[1][]{\begin{definition}[#1]}{\end{definition}}
}{
  \excludecomment{ndefinition}
}
\bool_if:NTF \c__mikoslides_notes_bool {
  \newenvironment{nassertion}[1][]{\begin{assertion}[#1]}{\end{assertion}}
}{
  \excludecomment{nassertion}
}
\bool_if:NTF \c__mikoslides_notes_bool {
  \newenvironment{nsproof}[2][]{\begin{sproof}[#1]{#2}}{\end{sproof}}
}{
  \excludecomment{nsproof}
}
\bool_if:NTF \c__mikoslides_notes_bool {
  \newenvironment{nexample}[1][]{\begin{example}[#1]}{\end{example}}
}{
  \excludecomment{nexample}
}
\def\inputref@preskip{\smallskip}
\def\inputref@postskip{\medskip}
\let\orig@inputref\inputref
\def\inputref{\@ifstar\ninputref\orig@inputref}
\newcommand\ninputref[2][]{
  \bool_if:NT \c__mikoslides_notes_bool {
    \orig@inputref[#1]{#2}
  }
}
\newlength{\slidelogoheight}

\bool_if:NTF \c__mikoslides_notes_bool {
  \setlength{\slidelogoheight}{.4cm}
}{
  \setlength{\slidelogoheight}{1cm}
}
\newsavebox{\slidelogo}
\sbox{\slidelogo}{\sTeX}
\newrobustcmd{\setslidelogo}[1]{
  \sbox{\slidelogo}{\includegraphics[height=\slidelogoheight]{#1}}
}
\def\source{Michael Kohlhase}% customize locally
\newrobustcmd{\setsource}[1]{\def\source{#1}}
\def\copyrightnotice{\footnotesize\copyright :\hspace{.3ex}{\source}}
\newsavebox{\cclogo}
\sbox{\cclogo}{\includegraphics[height=\slidelogoheight]{cc_somerights}}
\newif\ifcchref\cchreffalse
\AtBeginDocument{
  \@ifpackageloaded{hyperref}{\cchreftrue}{\cchreffalse}
}
\def\licensing{
  \ifcchref
    \href{http://creativecommons.org/licenses/by-sa/2.5/}{\usebox{\cclogo}}
  \else
    {\usebox{\cclogo}}
  \fi
}
\newrobustcmd{\setlicensing}[2][]{
  \def\@url{#1}
  \sbox{\cclogo}{\includegraphics[height=\slidelogoheight]{#2}}
  \ifx\@url\@empty
    \def\licensing{{\usebox{\cclogo}}}
  \else
    \def\licensing{
      \ifcchref
      \href{#1}{\usebox{\cclogo}}
      \else
      {\usebox{\cclogo}}
      \fi
    }
  \fi
}
\newrobustcmd\miko@slidelabel{
  \vbox to \slidelogoheight{
    \vss\hbox to \slidewidth
    {\licensing\hfill\copyrightnotice\hfill\arabic{slide}\hfill\usebox{\slidelogo}}
  }
}
\def\Gin@mhrepos{}
\define@key{Gin}{mhrepos}{\def\Gin@mhrepos{#1}}
\define@key{Gin}{label}{\def\@currentlabel{\arabic{slide}}\label{#1}}
\newrobustcmd\frameimage[2][]{
  \stepcounter{slide}
  \bool_if:NT \c__mikoslides_frameimages_bool {
    \def\Gin@ewidth{}\setkeys{Gin}{#1}
    \bool_if:NF \c__mikoslides_notes_bool { \vfill }
    \begin{center}
      \bool_if:NTF \c__mikoslides_fiboxed_bool {
        \fbox{
          \ifx\Gin@ewidth\@empty
            \ifx\Gin@mhrepos\@empty
              \mhgraphics[width=\slidewidth,#1]{#2}
            \else
              \mhgraphics[width=\slidewidth,#1,mhrepos=\Gin@mhrepos]{#2}
            \fi
          \else% Gin@ewidth empty
            \ifx\Gin@mhrepos\@empty
              \mhgraphics[#1]{#2}
            \else
              \mhgraphics[#1,mhrepos=\Gin@mhrepos]{#2}
            \fi
          \fi% Gin@ewidth empty
        }
      }{
        \ifx\Gin@ewidth\@empty
          \ifx\Gin@mhrepos\@empty
            \mhgraphics[width=\slidewidth,#1]{#2}
          \else
            \mhgraphics[width=\slidewidth,#1,mhrepos=\Gin@mhrepos]{#2}
          \fi
          \ifx\Gin@mhrepos\@empty
            \mhgraphics[#1]{#2}
          \else
            \mhgraphics[#1,mhrepos=\Gin@mhrepos]{#2}
          \fi
        \fi% Gin@ewidth empty
      }
     \end{center}
    \par\strut\hfill{\footnotesize Slide \arabic{slide}}%
    \bool_if:NF \c__mikoslides_notes_bool { \vfill }
  }
} % ifmks@sty@frameimages
\sffamily
\AddToHook{begindocument}{
  \definecolor{green}{rgb}{0,.5,0}
  \definecolor{purple}{cmyk}{.3,1,0,.17}
}
\def\defemph#1{{\textcolor{magenta}{#1}}}
\def\symrefemph#1{{\textcolor{cyan}{#1}}}
\def\compemph#1{{\textcolor{blue}{#1}}}
\def\titleemph#1{{\textcolor{blue}{#1}}}
\def\__omtext_lec#1{(\textcolor{green}{#1})}
\pgfdeclareimage[width=.8em]{miko@small@dbend}{dangerous-bend}
\def\smalltextwarning{
  \pgfuseimage{miko@small@dbend}
  \xspace
}
\pgfdeclareimage[width=1.2em]{miko@dbend}{dangerous-bend}
\newrobustcmd\textwarning{
  \raisebox{-.05cm}{\pgfuseimage{miko@dbend}}
  \xspace
}
\pgfdeclareimage[width=2.5em]{miko@big@dbend}{dangerous-bend}
\newrobustcmd\bigtextwarning{
  \raisebox{-.05cm}{\pgfuseimage{miko@big@dbend}}
  \xspace
}
\newrobustcmd\putgraphicsat[3]{
  \begin{picture}(0,0)\put(#1){\includegraphics[#2]{#3}}\end{picture}
}
\newrobustcmd\putat[2]{
  \begin{picture}(0,0)\put(#1){#2}\end{picture}
}
\bool_if:NT \c__mikoslides_sectocframes_bool {
  \str_if_eq:VnTF \__mikoslidestopsect{part}{
    \newcounter{chapter}\counterwithin*{section}{chapter}
  }{
    \str_if_eq:VnT\__mikoslidestopsect{chapter}{
      \newcounter{chapter}\counterwithin*{section}{chapter}
    }
  }
}
\def\part@prefix{}
\@ifpackageloaded{omdoc}{}{
  \str_case:VnF \__mikoslidestopsect {
    {part}{
      \int_set:Nn \l_document_structure_section_level_int {0}
      \def\thesection{\arabic{chapter}.\arabic{section}}
      \def\part@prefix{\arabic{chapter}.}
    }
    {chapter}{
      \int_set:Nn \l_document_structure_section_level_int {1}
      \def\thesection{\arabic{chapter}.\arabic{section}}
      \def\part@prefix{\arabic{chapter}.}
    }
  }{
    \int_set:Nn \l_document_structure_section_level_int {2}
    \def\part@prefix{}
  }
}

\bool_if:NF \c__mikoslides_notes_bool { % only in slides
  \renewenvironment{omgroup}[2][]{
    \__document_structure_omgroup_args:n { #1 }
    \int_incr:N \l_document_structure_omgroup_level_int
    \int_incr:N \l_document_structure_section_level_int
    \bool_if:NT \c__mikoslides_sectocframes_bool {
      \stepcounter{slide}
      \begin{frame}[noframenumbering]
      \vfill\Large\centering
      \red{
        \ifcase\l_document_structure_section_level_int\or
          \stepcounter{part}
          \def\__mikoslideslabel{\omdoc@part@kw~\Roman{part}}
          \def\currentsectionlevel{\omdoc@part@kw}
        \or
          \stepcounter{chapter}
          \def\__mikoslideslabel{\omdoc@chapter@kw~\arabic{chapter}}
          \def\currentsectionlevel{\omdoc@chapter@kw}
        \or
          \stepcounter{section}
          \def\__mikoslideslabel{\part@prefix\arabic{section}}
          \def\currentsectionlevel{\omdoc@section@kw}
        \or
          \stepcounter{subsection}
          \def\__mikoslideslabel{\part@prefix\arabic{section}.\arabic{subsection}}
          \def\currentsectionlevel{\omdoc@subsection@kw}
        \or
          \stepcounter{subsubsection}
          \def\__mikoslideslabel{\part@prefix\arabic{section}.\arabic{subsection}.\arabic{subsubsection}}
          \def\currentsectionlevel{\omdoc@subsubsection@kw}
        \or
          \stepcounter{mparagraph}
          \def\__mikoslideslabel{\part@prefix\arabic{section}.\arabic{msubsection}.\arabic{subsubsection}.\arabic{mparagraph}}
          \def\currentsectionlevel{\omdoc@paragraph@kw}
        \fi% end ifcase
        \__mikoslideslabel%\sref@label@id\__mikoslideslabel
        \quad #2%
      }%
      \vfill%
      \end{frame}%
    }
    \stex_ref_new_doc_target:n\l__document_structure_omgroup_id_str%
  }{}
}
\def\inserttheorembodyfont{\normalfont}
\bool_if:NF \c__mikoslides_notes_bool {
  \defbeamertemplate{theorem begin}{miko}
  {\inserttheoremheadfont\inserttheoremname\inserttheoremnumber
    \ifx\inserttheoremaddition\@empty\else\ (\inserttheoremaddition)\fi%
    \inserttheorempunctuation\inserttheorembodyfont\xspace}
  \defbeamertemplate{theorem end}{miko}{}
  \setbeamertemplate{theorems}[miko]
  \expandafter\def\csname Parent2\endcsname{}
}
\bool_if:NT \c__mikoslides_notes_bool {
  \renewenvironment{columns}[1][]{%
    \par\noindent%
    \begin{minipage}%
    \slidewidth\centering\leavevmode%
  }{%
    \end{minipage}\par\noindent%
  }%
  \newsavebox\columnbox%
  \renewenvironment<>{column}[2][]{%
    \begin{lrbox}{\columnbox}\begin{minipage}{#2}%
  }{%
    \end{minipage}\end{lrbox}\usebox\columnbox%
  }%
}
\bool_if:NTF \c__mikoslides_noproblems_bool {
  \newenvironment{problems}{}{}
}{
  \excludecomment{problems}
}
\gdef\printexcursions{}
\newcommand\excursionref[2]{% label, text
  \bool_if:NT \c__mikoslides_notes_bool {
    \begin{omtext}[title=Excursion]
      #2 \sref[fallback=the appendix]{#1}.
    \end{omtext}
  }
}
\newcommand\activate@excursion[2][]{
  \gappto\printexcursions{\inputref[#1]{#2}}
}
\newcommand\excursion[4][]{% repos, label, path, text
  \bool_if:NT \c__mikoslides_notes_bool {
    \activate@excursion[#1]{#3}\excursionref{#2}{#4}
  }
}
\keys_define:nn{mikoslides / excursiongroup }{
  id        .str_set_x:N  = \l__mikoslides_excursion_id_str,
  intro     .tl_set:N     = \l__mikoslides_excursion_intro_tl,
  mhrepos   .str_set_x:N  = \l__mikoslides_excursion_mhrepos_str
}
\cs_new_protected:Nn \__mikoslides_excursion_args:n {
  \tl_clear:N \l__mikoslides_excursion_intro_tl
  \str_clear:N \l__mikoslides_excursion_id_str
  \str_clear:N \l__mikoslides_excursion_mhrepos_str
  \keys_set:nn {mikoslides / excursiongroup }{ #1 }
}
\newcommand\excursiongroup[1][]{
  \__mikoslides_excursion_args:n{ #1 }
  \ifdefempty\printexcursions{}% only if there are excursions
  {\begin{note}
    \begin{omgroup}[#1]{Excursions}%
      \ifdefempty\l__mikoslides_excursion_intro_tl{}{
        \inputref[\l__mikoslides_excursion_mhrepos_str]{
          \l__mikoslides_excursion_intro_tl
        }
      }
      \printexcursions%
    \end{omgroup}
  \end{note}}
}
\endinput
%%
%% End of file `mikoslides.sty'.
