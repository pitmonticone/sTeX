%%
%% This is file `stex-compatibility.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% stex.dtx  (with options: `compat')
%% 

\ProvidesExplPackage{stex-compatibility}{2021/08/01}{1.9}{bla}
\RequirePackage[debug,lang={de,en}]{stex}

\NewDocumentEnvironment { mhmodnl } { O{} m m } {
  \msg_set:nnn{stex}{warning/deprecated}{
    \\
    Environment~mhmodnl~is~deprected! \\
    Please~update~module~#2~in~file~
    \stex_path_to_string:N \g_stex_currentfile_seq!
    \\ \\
  }
  \msg_warning:nn{stex}{warning/deprecated}

  \begin{module}[#1,lang=#3]{#2}
    \seq_set_eq:NN \l_tmpa_seq \g_stex_currentfile_seq
    \seq_pop_right:NN \l_tmpa_seq \l_tmpa_str
    \seq_set_split:NnV \l_tmpb_seq . \l_tmpa_str
    \seq_pop_left:NN \l_tmpb_seq \l_tmpa_str
    \input { \stex_path_to_string:N \l_tmpa_seq / \l_tmpa_str.tex }
} {
  \end{module}
}

\NewDocumentEnvironment { modsig } { O{} m } {
  \stex_if_in_module:TF {
    \prop_get:NnN \l_stex_current_module_prop {name} \l_tmpa_str
    \str_set:Nn \l_tmpb_str { #2 }
    \str_if_eq:NNTF \l_tmpa_str \l_tmpb_str {
      \prop_set_eq:NN \l_modsig_old_module_prop \l_stex_current_module_prop
      \begin{@module}{modsig-#2}
       % \prop_set_eq:NN \l_stex_current_module_prop \l_modsig_old_module_prop
    } {
      \begin{@module}{#2}
    }
  } {
    \begin{@module}{#2}
  }
}{
  \end{@module}
  \AddToHookNext { env / modsig / after }{
    \stex_if_in_module:T {
      \prop_get:NnN \l_stex_current_module_prop {name} \l_tmpa_str
      \str_set:Nn \l_tmpb_str { #2 }
      \str_if_eq:NNT \l_tmpa_str \l_tmpb_str {
  %      \xdef \g_stex_module_after_group_tl {
          \stex_if_smsmode:TF {
            \exp_args:Nx
            \stex_add_to_current_module:n {
              \stex_debug:n{Activating~signature~of~#2}
              \exp_not:N \prop_item:cn { c_stex_module_
              \prop_item:Nn \l_stex_current_module_prop {ns} ?
              \prop_item:Nn \l_stex_current_module_prop {name}
              / modsig-#2_prop } { content }
            }
          }
          {
            \gdef \g_stex_module_after_group_tl  {
              \stex_debug:n{Activating~signature~of~#2}

              \seq_put_right:Nx \l_stex_all_modules_seq {
                \prop_item:Nn \l_stex_current_module_prop {ns} ?
                \prop_item:Nn \l_stex_current_module_prop {name}
                / modsig-#2_prop
              }
              \prop_item:cn { c_stex_module_
              \prop_item:Nn \l_stex_current_module_prop {ns} ?
              \prop_item:Nn \l_stex_current_module_prop {name}
              / modsig-#2_prop } { content }
              \exp_args:Nx
              \stex_add_to_current_module:n {
                \stex_debug:n{Activating~signature~of~#2}
                \exp_not:N \prop_item:cn { c_stex_module_
                \prop_item:Nn \l_stex_current_module_prop {ns} ?
                \prop_item:Nn \l_stex_current_module_prop {name}
                / modsig-#2_prop } { content }
              }
            }
            \aftergroup \g_stex_module_after_group_tl
          }
  %      }
  %      \aftergroup \g_stex_module_after_group_tl
      }
    }
  }
}

\NewDocumentCommand \gimport { O{} m } {
  \msg_set:nnn{stex}{warning/deprecated}{
    \\
    \c_backslash_str gimport~is~deprecated! \\
    Please~use~\c_backslash_str importmodule[#1]{#2}~instead!~(in~file~
    \stex_path_to_string:N \g_stex_currentfile_seq)
    \\ \\
  }
  \msg_warning:nn{stex}{warning/deprecated}
  \importmodule[#1]{#2}
}

\cs_new_protected:Npn \symi {
  \peek_charcode_remove:NTF * {
    \symi_do:
  } {
    \symi_do:
  }
}

\NewDocumentCommand \symi_do: { O{} m } {
  \msg_set:nnn{stex}{warning/deprecated}{
    \\
    \c_backslash_str symi~is~deprecated! \\
    Please~use~\c_backslash_str symdecl[#1]{#2}~instead!~(in~file~
    \stex_path_to_string:N \g_stex_currentfile_seq)
    \\ \\
  }
  \msg_warning:nn{stex}{warning/deprecated}
  \symdecl*[#1]{#2}
}

\cs_new_protected:Npn \symii {
  \peek_charcode_remove:NTF * {
    \symii_do:
  } {
    \symii_do:
  }
}

\NewDocumentCommand \symii_do: { O{} m m } {
  \msg_set:nnn{stex}{warning/deprecated}{
    \\
    \c_backslash_str symii~is~deprecated! \\
    Please~use~\c_backslash_str symdecl[#1]{#2-#3}~instead!~(in~file~
    \stex_path_to_string:N \g_stex_currentfile_seq)
    \\ \\
  }
  \msg_warning:nn{stex}{warning/deprecated}
  \symdecl*[#1]{#2-#3}
}

\cs_new_protected:Npn \defi {
  \peek_charcode_remove:NTF * {
    \defi_do:
  } {
    \defi_do:
  }
}

\NewDocumentCommand \defi_do: { O{} m } {
  \str_set:Nn \l_tmpa_str { #1 }
  \str_if_empty:NTF \l_tmpa_str {
    \msg_set:nnn{stex}{warning/deprecated}{
      \\
      \c_backslash_str defi~is~deprecated! \\
      Please~use~\c_backslash_str STEXsymbol{#2}![#2]~instead!~(in~file~
      \stex_path_to_string:N \g_stex_currentfile_seq)
      \\ \\
    }
    \msg_warning:nn{stex}{warning/deprecated}
    \STEXsymbol { #2 }![ \comp{#2} ]
  } {
    \msg_set:nnn{stex}{warning/deprecated}{
      \\
      \c_backslash_str defi~is~deprecated! \\
      Please~use~\c_backslash_str STEXsymbol { #1 ? #2 }[ #2 ]~instead!~(in~file~
      \stex_path_to_string:N \g_stex_currentfile_seq)
      \\ \\
    }
    \msg_warning:nn{stex}{warning/deprecated}
    \STEXsymbole { #1 ? #2 }[ \comp{#2} ]
  }
}

\cs_new_protected:Npn \defii {
  \peek_charcode_remove:NTF * {
    \defii_do:
  } {
    \defii_do:
  }
}

\NewDocumentCommand \defii_do: { O{} m m } {
  \str_set:Nn \l_tmpa_str { #1 }
  \str_if_empty:NTF \l_tmpa_str {
    \msg_set:nnn{stex}{warning/deprecated}{
      \\
      \c_backslash_str defii~is~deprecated! \\
      Please~use~\c_backslash_str STEXsymbol{#2-#3}![#2~#3]~instead!~(in~file~
      \stex_path_to_string:N \g_stex_currentfile_seq)
      \\ \\
    }
    \msg_warning:nn{stex}{warning/deprecated}
    \STEXsymbol { #2-#3 }![ \comp{#2~#3} ]
  } {
    \msg_set:nnn{stex}{warning/deprecated}{
      \\
      \c_backslash_str defii~is~deprecated! \\
      Please~use~\c_backslash_str STEXsymbol { #1 ? #2-#3 }[ #2~#3 ]~instead!~(in~file~
      \stex_path_to_string:N \g_stex_currentfile_seq)
      \\ \\
    }
    \msg_warning:nn{stex}{warning/deprecated}
    \STEXsymbol { #1 ? #2-#3 }[ \comp{#2~#3} ]
  }
}


\NewDocumentEnvironment {definition} { O{} } {
  \stex_smsmode_set_codes:
  \msg_set:nnn{stex}{warning/deprecated}{
    \\
    definition~environment~is~deprecated!~(in~file~
    \stex_path_to_string:N \g_stex_currentfile_seq)
    \\ \\
  }
  \msg_warning:nn{stex}{warning/deprecated}
}{}

\NewDocumentCommand \trefi { O{} m } {
  \str_set:Nn \l_tmpa_str { #1 }
  \str_if_empty:NTF \l_tmpa_str {
    \msg_set:nnn{stex}{warning/deprecated}{
      \\
      \c_backslash_str trefi~is~deprecated! \\
      Please~use~\c_backslash_str STEXsymbol{#2}![#2]~instead!~(in~file~
      \stex_path_to_string:N \g_stex_currentfile_seq)
      \\ \\
    }
    \msg_warning:nn{stex}{warning/deprecated}
    \STEXsymbol { #2 }![ \comp{#2} ]
  } {
    \msg_set:nnn{stex}{warning/deprecated}{
      \\
      \c_backslash_str trefi~is~deprecated! \\
      Please~use~\c_backslash_str STEXsymbol { #1 ? #2 }[ #2 ]~instead!~(in~file~
      \stex_path_to_string:N \g_stex_currentfile_seq)
      \\ \\
    }
    \msg_warning:nn{stex}{warning/deprecated}
    \STEXsymbol { #1 ? #2 }[ \comp{#2} ]
  }
}

\seq_gput_right:Nx \g_stex_smsmode_allowedenvs_seq { \tl_to_str:n { mhmodnl } }
\seq_gput_right:Nx \g_stex_smsmode_allowedenvs_seq { \tl_to_str:n { modsig } }
\tl_gput_right:Nn \g_stex_smsmode_allowedmacros_escape_tl {\gimport\symi\symii\symiii\symiv}

\endinput
%%
%% End of file `stex-compatibility.sty'.
