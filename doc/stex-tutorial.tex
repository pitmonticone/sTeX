  \begin{sfragment}{A First \sTeX Document}
    Having set everything up, we can write a first
    \sTeX document. As an example, we will use the
    |smglom/calculus| and |smglom/arithmetics| archives, 
    which should be present in the designated |MathHub|-folder,
    and write a small fragment defining the \emph{geometric series}:

    \textcolor{red}{TODO: use some sTeX-archive instead of smglom,
    use a convergence-notion that includes the limit,
    mark-up the theorem properly}

    \begin{framed}\begin{latexcode}[gobble=8]
        \documentclass{article}
        \usepackage{stex,xcolor,stexthm}

        \begin{document}
        \begin{smodule}{GeometricSeries}
            \importmodule[smglom/calculus]{series}
            \importmodule[smglom/arithmetics]{realarith}

            \symdef{geometricSeries}[name=geometric-series]{\comp{S}}

            \begin{sdefinition}[for=geometricSeries]
                The \definame{geometricSeries} is the \symname{?series}
                \[\defeq{\geometricSeries}{\definiens{
                    \infinitesum{\svar{n}}{1}{
                        \realdivide[frac]{1}{
                            \realpower{2}{\svar{n}}
                    }}
                }}.\]
            \end{sdefinition}

            \begin{sassertion}[name=geometricSeriesConverges,type=theorem]
            The \symname{geometricSeries} \symname{converges} towards $1$.
            \end{sassertion}
        \end{smodule}
        \end{document}
    \end{latexcode}\end{framed}

    Compiling this document with |pdflatex| should yield
    the output

    \begin{mdframed}
        \noindent\textbf{Definition 0.1. }\ The 
        \pdftooltip{\textcolor{blue}{\textbf{geometric series}}}{URI: file://your/file/name/here?GeometricSeries?geometric-series}
        is the 
        \pdftooltip{\textcolor{blue}{series}}{URI: http://mathhub.info/smglom/calculus?series?series}
        \[
        \pdftooltip{\textcolor{blue}S}{URI: file://your/file/name/here?GeometricSeries?geometric-series}
        \pdftooltip{\textcolor{blue}{:=}}{URI: http://mathhub.info/smglom/mv?defeq?definitional-equation}
        \mathop{\pdftooltip{\textcolor{blue}{\sum}}{URI: http://mathhub.info/smglom/calculus?series?infinitesum}
        }_{
            \pdftooltip{\textcolor{gray}{n}}{Variable var://n}=1
        }^{
          \pdftooltip{\textcolor{blue}\infty}{URI: http://mathhub.info/smglom/calculus?series?infinitesum}
        } \frac{1}{2^{\pdftooltip{\textcolor{gray}{n}}{Variable var://n}}}
        .\]
        \noindent\textbf{Theorem 0.2. }\ The 
        \pdftooltip{\textcolor{blue}{geometric series}}{URI: file://your/file/name/here?GeometricSeries?geometric-series}
        \pdftooltip{\textcolor{blue}{converges}}{URI: http://mathhub.info/smglom/calculus?sequenceConvergence?converges} towards $1$.
    \end{mdframed}

    Feel free to move your cursor over the various highlighted parts
    of the document -- depending on your pdf viewer, this should
    yield some interesting (but possibly for now cryptic) information.

    \begin{sparagraph}[type=remark]
      Note that all of the highlighting, tooltips, coloring and the environment headers
      come from \pkg{stexthm} -- by default, the amount of additional packages loaded
      is kept to a minimum and all the presentations can be customized.
    \end{sparagraph}

    Let's investigate this document in detail now:\bigskip

    \begin{latexcode}[numbers=none,aboveskip=0pt,belowskip=0pt,gobble=8]
        \begin{smodule}{GeometricSeries}
        ...
        \end{smodule}
    \end{latexcode}
    \begin{environment}{smodule}
      First, we open a new \emph{module} called |GeometricSeries|.
      This module is assigned a \emph{globally unique} identifier (URI),
      which (depending on your pdf viewer) should pop up in a tooltip
      if you hover over the word 
      \pdftooltip{\textcolor{blue}{\textbf{geometric series}}}{URI: file://your/file/name/here?GeometricSeries?geometric-series}.
    \end{environment}\bigskip

    \begin{latexcode}[numbers=none,aboveskip=0pt,belowskip=0pt,gobble=8]
        \importmodule[smglom/calculus]{series}
        \importmodule[smglom/arithmetics]{realarith}
    \end{latexcode}
    \begin{function}{\importmodule}
      Next, we \emph{import} two modules -- 
      |series| in the |smglom/calculus|-archive, and |realarith| in
      the |smglom/arithmetics|-archive. If we investigate these archives,
      we find the files |series.en.tex| and |realarith.en.tex| (respectively) 
      in their respective |source|-folders, which contain 
      the statements \stexcode"\begin{smodule}{series}" and \stexcode"\begin{smodule}{realarith}"
      (respectively).
      \iffalse\end{smodule}\end{smodule}\fi

      The \stexcode"\importmodule"-statements make all \stex symbols and associated
      semantic macros (e.g. \stexcode"\infinitesum", \stexcode"\realdivide", 
      \stexcode"\realpower")
      in the desired module available. Additionally, they ``export''
      these symbols to all further modules which include the \emph{current}
      module -- i.e. if in some future module we would put
      \stexcode"\importmodule{GeometricSeries}", we would also have \stexcode"\infinitesum"
      etc. at our disposal.
    \end{function}

    \begin{function}{\usemodule}
      If we only want to \emph{use} the content of some module |Foo|,
      e.g. in remarks or examples, but none
      of the symbols in our current module actually \emph{depend} on
      the content of |Foo|, we can use \stexcode"\usemodule" instead -- like
      \stexcode"\importmodule", this will make the module content available,
      but will \emph{not} export it to other modules.
    \end{function}\bigskip

    \begin{latexcode}[numbers=none,aboveskip=0pt,belowskip=0pt,gobble=6]
      \symdef{GeometricSeries}[name=geometric-series]{\comp{S}}
    \end{latexcode}
    \begin{function}{\symdef}
      Next, we introduce a new \emph{symbol} with name
      |geometric-series| and assign it the semantic macro
      \stexcode"\geometricSeries".
      \stexcode"\symdef" also immediately assigns this symbol a \emph{notation},
      namely $S$.
    \end{function}

    \begin{function}{\comp}
      The macro \stexcode"\comp" marks the $S$ in the notation as a
      \emph{notational component}, as opposed to e.g. arguments
      to \stexcode"\geometricSeries".
      It is the notational components that get highlighted
      and associated with the corresponding symbol (i.e. in this
      case |geometricSeries|). Since \stexcode"\geometricSeries" takes
      no arguments, we can wrap the whole notation in a \stexcode"\comp".
    \end{function}\bigskip

    \begin{latexcode}[numbers=none,aboveskip=0pt,belowskip=0pt,gobble=8]
        \begin{sdefinition}[for=geometricSeries]
        ...
        \end{sdefinition}
        \begin{sassertion}[name=geometricSeriesConverges,type=theorem]
        ...
        \end{sassertion}
    \end{latexcode}
    What follows are two \sTeX-\emph{statements} (e.g. definitions,
    theorems, examples, proofs, ...). These are semantically marked-up
    variants of the usual environments, which take additional optional
    arguments (e.g. |for=|, |type=|, |name=|). Since many \LaTeX\xspace templates
    predefine environments like |definition| or |theorem| with
    different syntax, we use \stexcode"sdefinition", 
    \stexcode"sassertion", \stexcode"sexample"
    etc. instead. You can customize these environments to e.g.
    simply wrap around some predefined |theorem|-environment.
    That way, we can still use \stexcode"sassertion" to provide semantic
    information, while being fully compatible with (and using
    the document presentation of) predefined environments.

    In our case, the \pkg{stexthm}-package patches
    e.g. \stexcode"\begin{sassertion}[type=theorem]" to use
    a |theorem|-environment defined (as usual) using \pkg{amsthm}.
    \bigskip \iffalse \end{sassertion}\fi

    \begin{latexcode}[numbers=none,aboveskip=0pt,belowskip=0pt,gobble=6]
      The \definame{geometricSeries} is the \symname{?series}
    \end{latexcode}
    \begin{function}{\symname}
      The \stexcode"\symname"-command prints the name of a symbol,
      highlights it (based on customizable settings)
      and associates the text printed with the corresponding
      symbol. If you hover over the word
      \pdftooltip{\textcolor{blue}{series}}{URI: http://mathhub.info/smglom/calculus?series?series}
      in the pdf output, you should see a tooltip showing the full URI
      of the symbol used.
    \end{function}
    \begin{function}{\symref}
      The \stexcode"\symname"-command is a special case of the more general
      \stexcode"\symref"-command, which allows customizing the precise
      text associated with a symbol.
    \end{function}
    \begin{function}{\definame,\definiendum}
      The \stexcode"sdefinition"-environment provides two additional
      macros, \stexcode"\definame" and \stexcode"\definiendum" which behave
      similar to \stexcode"\symname" and \stexcode"\symref", but explicitly mark
      the symbols as \emph{being defined} in this environment,
      to allow for special highlighting.
    \end{function}\bigskip

    \begin{latexcode}[numbers=none,aboveskip=0pt,belowskip=0pt,gobble=8]
        \[\defeq{\geometricSeries}{\definiens{
            \infinitesum{\svar{n}}{1}{
                \realdivide[frac]{1}{
                    \realpower{2}{\svar{n}}
            }}
        }}.\]
    \end{latexcode}
    The next snippet -- set in a math environment -- uses
    several semantic macros imported from (or recursively via) 
    |series| and |realarithmetics|, such as \stexcode"\defeq", 
    \stexcode"\infinitesum",
    etc. In math mode, using a semantic macro inserts its (default)
    definition. A semantic macro can have several notations -- in
    that case, we can explicitly choose a specific notation by
    providing its identifier as an optional argument; e.g.
    \stexcode"\realdivide[frac]{a}{b}" will use the explicit notation named |frac|
    of the semantic macro \stexcode"\realdivide", which yields $\frac ab$
    instead of $a/b$.
    \begin{function}{\svar}
      The \stexcode"\svar{n}" command marks up the |n| as a variable
      with name |n| and notation |n|.
    \end{function}
    \begin{function}{\definiens}
      The \stexcode"sdefinition"-environment additionally provides the
      \stexcode"\definiens"-command, which allows for explicitly
      marking up its argument as the \emph{definiens} of the
      symbol currently being defined.
    \end{function}

    \begin{sfragment}{\omdoc/xhtml Conversion}
      So, if we run |pdflatex| on our document, then \sTeX yields 
      pretty colors and
      tooltips\footnote{...and hyperlinks for symbols, and indices,
      and allows reusing document fragments modularly, and...}.
      But \sTeX becomes a lot more powerful if we additionally
      convert our document to |xhtml|.

      \textcolor{red}{TODO VSCode Plugin}

      Using \rustex, we can convert the document to |xhtml|
      using the command |rustex -i /path/to/file.tex -o /path/to/outfile.xhtml|.
      Investigating the resulting file, we notice additionaly semantic
      information resulting from our usage of semantic macros,
      \stexcode"\symref" etc. Below is the (abbreviated) snippet inside
      our \stexcode"\definiens" block:

      \begin{lstlisting}[escapechar=!]
<mrow resource="" property="stex:definiens">
 <mrow resource="...?series?infinitesum##" property="stex:OMBIND">
  <munderover displaystyle="true">
   <mo resource="...?series?infinitesum" property="stex:comp">!$\Sigma$!</mo>
   <mrow>
    <mi resource="1" property="stex:arg">n</mi>
    <mo class="rel">=</mo>
    <mi resource="2" property="stex:arg">1</mi>
   </mrow>
   <mi resource="...?series?infinitesum" property="stex:comp">!$\infty$!</mi>
  </munderover>
   <mrow resource="3" property="stex:arg">
    <mfrac resource="...?realarith?division#frac#" property="stex:OMA">
     <mi resource="1" property="stex:arg">1</mi>
     <mrow resource="2" property="stex:arg">
     <mo class="opening">(</mo>
     <msup resource="...realarith?exponentiation##" property="stex:OMA">
      <mi resource="1" property="stex:arg">2</mi>
      <mi resource="2" property="stex:arg">n</mi>
     </msup>
     <mo class="closing">)</mo>
    </mrow>
   </mfrac>
  </mrow>
 </mrow>
</mrow>
      \end{lstlisting}
      ...containing all the semantic information. The \mmt system
      can extract from this the following \openmath snippet:

      \begin{lstlisting}[escapechar=!]
<OMBIND>
  <OMID name="...?series?infinitesum"/>
  <OMV name="n"/>
  <OMLIT name="1"/>
  <OMA>
    <OMS name="...?realarith?division"/>
    <OMLIT name="1"/>
    <OMA>
      <OMS name="...realarith?exponentiation"/>
      <OMLIT name="2"/>
      <OMV name="n"/>
    </OMA>
  </OMA>
</OMBIND>
      \end{lstlisting}
      ...giving us the full semantics of the snippet, allowing for
      a plurality of knowledge management services -- in particular
      when serving the |xhtml|.

      \begin{remark}
          Note that the |html| when opened in a browser will
          look slightly different than the |pdf| when it comes
          to highlighting semantic content -- that is because
          naturally |html| allows for much more powerful
          features than |pdf| does. Consequently, the |html|
          is intended to be served by a system like \mmt,
          which can pick up on the semantic information and
          offer much more powerful highlighting, linking
          and similar features, and being customizable by
          \emph{readers} rather than being prescribed by an author.

          Additionally, not all browsers (most notably Chrome)
          support \mathml natively, and might require
          additional external JavaScript libraries such as
          MathJax to render mathematical formulas properly.
      \end{remark}
    \end{sfragment}
\end{sfragment}