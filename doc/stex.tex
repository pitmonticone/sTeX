\def\bibfolder{../lib/bib}
\input{docheader}

\ExplSyntaxOn
\def\OmitDocInput#1{
\clist_gput_right:Nn \g_docinput_clist
  { #1 }
}
\bool_set_true:N \stex_dtx_tests_bool
\ExplSyntaxOff

\expandafter\newif\csname if@infulldoc\expandafter\endcsname\csname @infulldoctrue\endcsname

\begin{document}
	\title{
		The {\stex{3}} Package
		\thanks{Version {\fileversion} (last revised {\filedate})}
 	}
	\author{Michael Kohlhase, Dennis Müller\\
		FAU Erlangen-Nürnberg\\
		\url{http://kwarc.info/}
	}
	\pagenumbering{roman}
	\maketitle
	
	\input{abstract}
	
	\makeatletter
		\renewcommand\part{%
    		\clearpage
  			\thispagestyle{plain}%
  			\@tempswafalse
  			\null\vfil
  			\secdef\@part\@spart%
  		}
		\newcounter{chapter}
		\numberwithin{section}{chapter}
		\renewcommand\thechapter{\@arabic\c@chapter}
		\renewcommand\thesection{\thechapter.\@arabic\c@section}
		\newcommand*\chaptermark[1]{}
		\setcounter{secnumdepth}{2}
		\newcommand\@chapapp{\chaptername}
		%\newcommand\chaptername{Chapter}
  		\def\ps@headings{%
    		\let\@oddfoot\@empty
    		\def\@oddhead{{\slshape\rightmark}\hfil\thepage}%
    		\let\@mkboth\markboth
    		\def\chaptermark##1{%
      			\markright{\MakeUppercase{%
        			\ifnum \c@secnumdepth >\m@ne
            			\@chapapp\ \thechapter. \ %
        			\fi
        		##1}}%
        	}%
        }
		\newcommand\chapter{\clearpage
			\thispagestyle{plain}%
			\global\@topnum\z@
			\@afterindentfalse
			\secdef\@chapter\@schapter%
		}
		\def\@chapter[#1]#2{\refstepcounter{chapter}%
			\typeout{\@chapapp\space\thechapter.}%
			\addcontentsline{toc}{chapter}%
				{\protect\numberline{\thechapter}#1}%
			\chaptermark{#1}%
			\addtocontents{lof}{\protect\addvspace{10\p@}}%
			\addtocontents{lot}{\protect\addvspace{10\p@}}%
			\@makechapterhead{#2}%
			\@afterheading%
		}
		\def\@makechapterhead#1{%
			\vspace*{50\p@}%
			{\parindent \z@ \raggedright \normalfont
				\huge\bfseries \@chapapp\space \thechapter
				\par\nobreak
				\vskip 20\p@
				\interlinepenalty\@M
				\Huge \bfseries #1\par\nobreak
				\vskip 40\p@
			}%
		}
\newcommand*\l@chapter[2]{%
  \ifnum \c@tocdepth >\m@ne
    \addpenalty{-\@highpenalty}%
    \vskip 1.0em \@plus\p@
    \setlength\@tempdima{1.5em}%
    \begingroup
      \parindent \z@ \rightskip \@pnumwidth
      \parfillskip -\@pnumwidth
      \leavevmode \bfseries
      \advance\leftskip\@tempdima
      \hskip -\leftskip
      #1\nobreak\hfil
      \nobreak\hb@xt@\@pnumwidth{\hss #2%
                                 \kern-\p@\kern\p@}\par
      \penalty\@highpenalty
    \endgroup
  \fi}
\renewcommand*\l@section{\@dottedtocline{1}{1.5em}{2.8em}}
\renewcommand*\l@subsection{\@dottedtocline{2}{3.8em}{3.2em}}
\renewcommand*\l@subsubsection{\@dottedtocline{3}{7.0em}{4.1em}}
\def\partname{Part}
\def\toclevel@part{-1}
\def\maketitle{\chapter{\@title}}
\let\thanks\@gobble
\let\DelayPrintIndex\PrintIndex
\let\PrintIndex\@empty
\providecommand*{\hexnum}[1]{\text{\texttt{\char`\"}#1}}
\makeatother

\clearpage

{%
  \def\\{:}% fix "newlines" in the ToC
  \tableofcontents
}

\clearpage
\pagenumbering{arabic}

\part{Manual}

%\let\oldsubsubsection\subsubsection
%\let\subsubsection\section
%\let\subsection\section
%\let\section\chapter

\input{manual}

%\let\section\subsection
%\let\subsection\subsubsection
%\let\subsubsection\oldsubsubsection

\part{Documentation}


%\errmessage{\expandafter\meaning\csname comment \endcsname}
\DisableImplementation


\DocInput{../sty/stex/basics.dtx}
\DocInput{../sty/stex/mathhub.dtx}
\DocInput{../sty/stex/references.dtx}
\DocInput{../sty/stex/modules.dtx}
\DocInput{../sty/stex/inheritance.dtx}
\DocInput{../sty/stex/symbols.dtx}
\DocInput{../sty/stex/terms.dtx}
\DocInput{../sty/stex/features.dtx}
\DocInput{../sty/stex/statements.dtx}

\OmitDocInput{../sty/stex/others.dtx}
\DocInput{../sty/stex/metatheory.dtx}

\part{Extensions}

\DocInput{../sty/extensions/tikzinput.dtx}
\DocInput{../sty/extensions/omdoc.dtx}
\DocInput{../sty/extensions/mikoslides.dtx}


\part{Implementation}

\def\maketitle{}
\let\subsubsection\section
\let\subsection\section
\let\section\chapter

\EnableImplementation
\DisableDocumentation

\DocInputAgain

\end{document}
