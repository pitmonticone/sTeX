\documentclass{stex}
\libinput{docpreamble}
\begin{document}
  \begin{smodule}{Category}
  	A category is...
    \begin{mathstructure}{cat}[category]
        \symdef{obj}[name=objects,type=footype,def=foodef]{\comp{\mathrm{obj}}_{\this}}
        \symdef{hom}[name=morphisms,args=2,op=\mathrm{hom}]{\comp{\mathrm{hom}}_{\this}\comp(#1\comp,#2\comp)}
        \symdef{com}[name=composition,args=a,op={\circ_{\this}}]{#1}{##1 \mathbin{\comp{\circ}_{\this}} ##2}

        \symdecl*{axiom 1}
        \symdecl*{axiom 2}
        \symdecl*{axiom 3}
    \end{mathstructure}
    
    
    $\cat!$

    \vardef{C}[return=\cat]{\comp C}
    \vardef{D}[return=\cat]{\comp D}
    \vardef{E}[return=\cat]{\comp E}

    $\C!,\D!,\E!$

    \begin{mathstructure}{functor}
        \symdef{dom}[name=domain,return=\cat]{\comp{\mathrm{dom}}_{\this}}
        \symdef{cod}[name=codomain,return=\cat]{\comp{\mathrm{cod}}_{\this}}
        \symdef{obj}[args=1,op=\mathrm{o}_{\this}]{\this\comp(#1\comp)}
        \symdef{hom}[args=1,op=\mathrm{f}_{\this}]{\this\comp(#1\comp)}

        \symdecl*{axiom 1}
        \symdecl*{axiom 2}
        \symdecl*{axiom 3}
    \end{mathstructure}

    $\functor!$

    $\functor![dom,cod]$

    \vardef{F}[return={\functor<dom=\C,cod=\D>},op=F]{\comp{F}}
    \vardef{G}[return={\functor<dom=\D,cod=\E>},op=G]{\comp{G}}

    $\F!,\F{dom}!,\F{obj}!,\F{cod}!, \F{dom}{obj}$


    \notation{functor/domain}[op=\mathrm{dom}]{\comp{\mathrm{dom}}_{#1}}
    \notation{functor/codomain}[op=\mathrm{cod}]{\comp{\mathrm{cod}}_{#1}}

    \symdef{funcomp}[name=functor composition,args=2,op=\circ,return={\functor<
        dom=\symuse{functor/domain}{#1}, 
        cod=\symuse{functor/codomain}{#2},
        obj={something},
        hom={something},
        axiom 1={something},
        axiom 2={something},
        axiom 3={something}
    >}]{#1 \mathbin{\comp{\circ}} #2}

    $\funcomp{\F!}{\G!}{dom}!, \funcomp{\F!}{\G!}{cod}!$

    $\funcomp{\F!}{\G!}{dom}{hom}AB$

    \symdef{CAT}[return={\cat<
        obj = \cat,
        hom = \functor,
        com = \funcomp,
        axiom 1={something},
        axiom 2={something},
        axiom 3={something},
    >}]{\comp{\mathrm{CAT}}}

    $\CAT!, \CAT{obj}!, \CAT{hom}!, \CAT{obj}{}{obj}!$

    \begin{mathstructure}{nattrans}[natural transformation]
        \symdef{domC}[name=domain category,return=\cat]{\comp{\mathrm{domC}}_{\this}}
        \symdef{codC}[name=codomain category,return=\cat]{\comp{\mathrm{codC}}_{\this}}
        \symdef{dom}[name=domain,return={\functor<dom=\domC,cod=\codC>}]{\comp{\mathrm{dom}}_{\this}}
        \symdef{cod}[name=codomain,return={\functor<dom=\domC,cod=\codC>}]{\comp{\mathrm{cod}}_{\this}}
        \symdef{fun}[args=1,op=f]{\this\comp(#1\comp)}

        \symdecl*{axiom 1}
        \symdecl*{axiom 2}
        \symdecl*{axiom 3}
    \end{mathstructure}
 
    $\nattrans!$

    \vardef{G}[return={\functor<dom=\C,cod=\D>},op=G]{\comp{G}}
    \vardef{H}[return={\functor<dom=\C,cod=\D>},op=H]{\comp{H}}

    \vardef{Na}[return={\nattrans<domC=\C,codC=\D,dom=\F,cod=\G>},op=N_1]{\comp{N_1}}
    \vardef{Nb}[return={\functor<domC=\C,codC=\D>,dom=\G,cod=\H},op=N_2]{\comp{N_2}}

    $\Na!,\Na{domC}!,\Na{dom}!, \Na{dom}{dom}!, \Na{dom}{dom}{obj}!$


    \notation{natural transformation/domain category}[op=\mathrm{domC}]{\comp{\mathrm{domC}}_{#1}}
    \notation{natural transformation/codomain category}[op=\mathrm{codC}]{\comp{\mathrm{codC}}_{#1}}

    \notation{natural transformation/domain}[op=\mathrm{dom}]{\comp{\mathrm{dom}}_{#1}}
    \notation{natural transformation/codomain}[op=\mathrm{cod}]{\comp{\mathrm{cod}}_{#1}}

    \symdef{natcomp}[name=natural transformation composition,args=2,op=\circ,return={\nattrans<
        domC=\symuse{natural transformation/domain category}{#1}, 
        codC=\symuse{natural transformation/codomain category}{#1},
        dom=\symuse{natural transformation/domain}{#1},
        cod=\symuse{natural transformation/codomain}{#2},
        fun={something},
        axiom 1={something},
        axiom 2={something},
        axiom 3={something},
    >}]{#1 \mathbin{\comp{\circ}} #2}

    $
        \natcomp{\Na!}{\Nb!}!, 
        \natcomp{\Na!}{\Nb!}{domC}!, 
        \natcomp{\Na!}{\Nb!}{dom}!,
        \natcomp{\Na!}{\Nb!}{dom}{dom}!,
        \natcomp{\Na!}{\Nb!}{dom}{dom}{obj}!
    $

%\end{smodule}\end{document}\endinput

    \symdef{funcat}[args=2,return={\cat<
        obj ={\functor<dom=#1,cod=#2>},
        hom ={\nattrans<domC=#1,codC=#2,dom=firstarg,cod=firstarg>},
        com = \natcomp,
        axiom 1={something},
        axiom 2={something},
        axiom 3={something},
    >},op=\mathrm{FUN}]{\comp{\mathrm{FUN}}_{#1\comp\to#2}}

    $\funcat!,\funcat{\C!}{\D!}!,\funcat{\C!}{\D!}{obj}{}{obj}!$

    \varnotation{C}[cc]{\comp{\mathtt{CC}}}

    $\C!,\C![cc]$

    %\rustexBREAK

    \varseqin{Cs}[args=3]{i,j}{FOO,FOO}{\comp{C}_{#1,#2}}{\comp{C}_{#1,#2}^{#3}}

    $\Cs!$

    $\Cs ab!$

    $\Cs abc$
    
    \varseqrange{Cs}[return=\cat,args=3][2]{11,\ellipses,nm}{\comp{C}_{#1,#2}}{\comp{C}_{#1,#2}^{#3}}

    $\Cs!$

    $\Cs ab!$

    $\Cs abc!$

    $\Cs abc{hom}xy$
  \end{smodule}
\end{document}
