\RequirePackage{stex-highlighting}
\RequirePackage{stexthm}
\libinput{examples}
\def\LoadClass#1{}
\makeatletter
\input{l3doc.cls}
\makeatother

\ExplSyntaxOff
\makeatletter
\newcount\example@counter\example@counter=0

\newtcolorbox{exampleborderboxi}[1][]{
  empty,
  title={Example \the\example@counter #1},
  attach boxed title to top left,
     minipage boxed title,
  boxed title style={empty,size=minimal,toprule=0pt,top=1pt,left=3mm,overlay={}},
  coltitle=blue,fonttitle=\bfseries,
  parbox=false,boxsep=0pt,left=3mm,right=0mm,top=2pt,breakable,pad at break=0mm,
     before upper=\csname @totalleftmargin\endcsname0pt, 
  overlay unbroken={\draw[blue,line width=2pt] ([xshift=-0pt]title.north west) -- ([xshift=-0pt]frame.south west); },
  overlay first={\draw[blue,line width=2pt] ([xshift=-0pt]title.north west) -- ([xshift=-0pt]frame.south west); },
  overlay middle={\draw[blue,line width=2pt] ([xshift=-0pt]frame.north west) -- ([xshift=-0pt]frame.south west); },
  overlay last={\draw[blue,line width=2pt] ([xshift=-0pt]frame.north west) -- ([xshift=-0pt]frame.south west); },
  outer arc=4pt%
}

\newenvironment{exampleborderbox}[1][]{
  \ifstexhtml\par\vbox\bgroup
    \csname exp_args:Nne\endcsname\begin{stex_annotate_env}{%
      style={%
        border-left:solid 2px blue;%
        background-color:white;%
        width:98\csname c_percent_str\endcsname;%
        padding-left:1\csname c_percent_str\endcsname
      }%
    }%
      \textcolor{blue}{\textbf{Example \the\example@counter #1}}\\
  \else\begin{exampleborderboxi}[#1]\fi
}{
  \ifstexhtml
    \end{stex_annotate_env}\egroup\par
  \else
\end{exampleborderboxi}\fi
}



% ------------------------------------------------------------


\ExplSyntaxOn
\stexstyleexample{
  \global\advance\example@counter by 1
  \tl_if_empty:NTF\thistitle{
    \begin{exampleborderbox}
  }{
    \begin{exampleborderbox}[ (\thistitle)]
  }
}{
    \end{exampleborderbox}
}

\ExplSyntaxOff\makeatother


\def\textwarning{\includegraphics[width=1.2em]{stex-dangerous-bend}\xspace}
\newtcolorbox{dangerbox}{
  breakable,
  enhanced,
  left=0pt,
  right=0pt,
  top=8pt,
  bottom=8pt,
  colback=white,
  colframe=red,
  width=\textwidth,
  enlarge left by=0mm,
  boxsep=5pt,
  fontupper=\small,
  arc=4pt,
  outer arc=4pt,
  leftupper=1.5cm,
  overlay={
    \node[anchor=west] at ([xshift=10pt]$(frame.north west)!0.5!(frame.south west)$)
       {\includegraphics[width=1cm,height=1cm]{stex-dangerous-bend}};}
}

\usetikzlibrary{decorations.pathmorphing,shapes,arrows,calc}
% Taken from pgflibrarytikzmmt.code.tex
\newcommand{\mmtarrowtip}{angle 45}
\newcommand{\mmtarrowtipmonoright}{right hook}

\tikzstyle{include}=[\mmtarrowtipmonoright-\mmtarrowtip,thick]
\tikzstyle{morph}=[-\mmtarrowtip,thick]
\tikzstyle{preview}=[decorate, decoration={coil,aspect=0,amplitude=1pt,
                                                  segment length=6pt,
                                                  pre=lineto,pre length=3pt,
                                                  post=lineto,post length=5pt}, thick]
\tikzstyle{view}=[preview,-\mmtarrowtip]

% TIKZ RULES
\def\mmtlogo{
\begin{tikzpicture}

  % White Background (Margins are eyeballed)
  % This is necessary because we paste white over arrows later.
  % If somebody want's to do the full song and dance with
  % interrupted arrows to get transparent background, be my guest.

  \fill[white!] (-0.01,0.15) rectangle (1.11,-0.95);

  % Arrows
  \draw [blue, include] (0,0)     -- (1.1,0);
  \draw [green, morph] (0,-0.4)  -- (1.1,-0.4);
  \draw [red, view]   (-0,-0.8) -- (1.1,-0.8);

  % Cutout for letters
  \fill[white] (0.33,0.1) rectangle (0.66,-0.9);

  % Letters
  \node at (0.18,0)    (nodeM1) {\large M};
  \node at (0.18,-0.4) (nodeM2) {\large M};
  \node at (0.21,-0.8) (nodeT)  {\large T};

\end{tikzpicture}
}

\newtcolorbox{mmtbox}{
  breakable,
  enhanced,
  left=0pt,
  right=0pt,
  top=8pt,
  bottom=8pt,
  colback=white,
  colframe=green,
  width=\textwidth,
  enlarge left by=0mm,
  boxsep=5pt,
  fontupper=\small,
  arc=4pt,
  outer arc=4pt,
  leftupper=1.5cm,
  overlay={
    \node[anchor=west] at ([xshift=10pt]$(frame.north west)!0.5!(frame.south west)$)
       {\mmtlogo};}
}

\newtcolorbox{defibox}{
  breakable,
  enhanced,
  left=0pt,
  right=0pt,
  top=8pt,
  bottom=8pt,
  colback=white,
  colframe=orange,
  width=\textwidth,
  enlarge left by=0mm,
  boxsep=5pt,
  fontupper=\small,
  leftupper=1.5cm,
  arc=4pt,
  outer arc=4pt,
  overlay={\node[anchor=west] at ([xshift=10pt]$(frame.north west)!0.5!(frame.south west)$)
       {\textcolor{orange}{\Large\sTeX}};}
}

\stexstyleparagraph[defibox]{
  \begin{defibox}
}{
  \end{defibox}
}
